<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multi-User App</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container mt-5">

        <!-- Registration Page -->
        <div id="registerPage">
            <div class="col-md-4 mx-auto">
                <div class="card shadow rounded">
                    <div class="card-body p-4">
                        <h2 class="text-center mb-4">Register</h2>
                        <div class=" mb-3">
                            <label for="regEmail">Email</label>
                            <input type="email" id="regEmail" class="form-control" />
                            <div id="regEmailError" class="text-danger small mt-1"></div>
                        </div>
                        <div class="mb-3">
                            <label for="regPassword">Password</label>
                            <input type="password" id="regPassword" class="form-control" />
                            <div id="regPasswordError" class="text-danger small mt-1"></div>
                        </div>
                        <div class="text-danger" id="registerError"></div>
                        <button class="btn btn-primary w-100 mb-2" onclick="register()">Register</button>
                        <p class="text-center">Already have an account? <a href="#" onclick="togglePages('login')">Login
                                here</a></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Page -->
        <div id="loginPage" style="display:none;">
            <div class="col-md-4 mx-auto">
                <div class="card shadow rounded">
                    <div class="card-body p-4">
                        <h2 class="text-center mb-4">Login</h2>
                        <div class="mb-3">
                            <label>Email</label>
                            <input type="email" id="loginEmail" class="form-control" />
                            <div id="loginEmailError" class="text-danger small mt-1"></div>
                        </div>
                        <div class="mb-3">
                            <label>Password</label>
                            <input type="password" id="loginPassword" class="form-control" />
                            <div id="loginPasswordError" class="text-danger small mt-1"></div>
                        </div>
                        <div class="text-danger" id="loginError"></div>
                        <button class="btn btn-success w-100 mb-2" onclick="login()">Login</button>
                        <p class="text-center">Don't have an account? <a href="#"
                                onclick="togglePages('register')">Register here</a></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Page -->
        <div id="accountPage" style="display:none;">
            <div class="col-md-8 mx-auto">
                <div class="card shadow rounded">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3 class="mb-0">Account Page</h3>
                            <button class="btn btn-danger btn-sm" onclick="logout()">Logout</button>
                        </div>

                        <div class="mb-3">
                            <label>Name</label>
                            <input type="text" id="nameInput" class="form-control" />
                            <div id="nameError" class="text-danger small mt-1"></div>
                        </div>
                        <div class="mb-3">
                            <label>Designation</label>
                            <input type="text" id="designationInput" class="form-control" />
                            <div id="designationError" class="text-danger small mt-1"></div>
                        </div>
                        <div class="mb-3">
                            <label>Message</label>
                            <textarea id="messageInput" class="form-control" rows="3"></textarea>
                            <div id="messageError" class="text-danger small mt-1"></div>
                        </div>
                        <div class="mb-3">
                            <button class="btn btn-primary me-2" onclick="saveData()">Save</button>
                        </div>
                        <div id="tableWrapper" class="container mt-4" style="display:none;">
                            <div class="container mt-4">
                                <div class="card">
                                    <div class="card-body">
                                        <table class="table table-bordered align-middle">
                                            <thead class="table-light text-center">
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Designation</th>
                                                    <th>Message</th>
                                                    <th class="text-end">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody class="text-center" id="displayContainer">
                                                <!-- Rows will Display here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function togglePages(page) {
            document.getElementById("registerPage").style.display = (page === "register") ? "block" : "none";
            document.getElementById("loginPage").style.display = (page === "login") ? "block" : "none";
            document.getElementById("accountPage").style.display = "none";
        }

        function register() {
            const email = document.getElementById("regEmail").value.trim();
            const password = document.getElementById("regPassword").value.trim();
            const emailErr = document.getElementById("regEmailError");
            const passErr = document.getElementById("regPasswordError");
            const regErr = document.getElementById("registerError");

            emailErr.textContent = passErr.textContent = regErr.textContent = "";

            if (!email) return emailErr.textContent = "Email required";
            if (!password) return passErr.textContent = "Password required";

            let users = JSON.parse(localStorage.getItem("users")) || {};
            if (users[email]) return regErr.textContent = "Email already exists";

            users[email] = { password, entries: [] };
            localStorage.setItem("users", JSON.stringify(users));
            alert("Registration successful. Please login.");
            togglePages("login");
        }

        function login() {
            const email = document.getElementById("loginEmail").value.trim();
            const password = document.getElementById("loginPassword").value.trim();
            const emailErr = document.getElementById("loginEmailError");
            const passErr = document.getElementById("loginPasswordError");
            const loginErr = document.getElementById("loginError");

            emailErr.textContent = passErr.textContent = loginErr.textContent = "";

            if (!email) return emailErr.textContent = "Email required";
            if (!password) return passErr.textContent = "Password required";

            let users = JSON.parse(localStorage.getItem("users")) || {};
            if (!users[email] || users[email].password !== password) return loginErr.textContent = "Invalid credentials";

            localStorage.setItem("currentUser", email);
            loadAccountPage(email);
        }

        function loadAccountPage(email) {
            togglePages("");
            document.getElementById("accountPage").style.display = "block";
            displayEntries();
        }

        function saveData() {
            const name = document.getElementById("nameInput").value.trim();
            const designation = document.getElementById("designationInput").value.trim();
            const message = document.getElementById("messageInput").value.trim();
            const email = localStorage.getItem("currentUser");

            document.getElementById("nameError").textContent =
                document.getElementById("designationError").textContent =
                document.getElementById("messageError").textContent = "";

            if (!name) return document.getElementById("nameError").textContent = "Name required";
            if (!designation) return document.getElementById("designationError").textContent = "Designation required";
            if (!message) return document.getElementById("messageError").textContent = "Message required";

            let users = JSON.parse(localStorage.getItem("users"));
            users[email].entries.push({ name, designation, message });
            localStorage.setItem("users", JSON.stringify(users));

            document.getElementById("nameInput").value = "";
            document.getElementById("designationInput").value = "";
            document.getElementById("messageInput").value = "";

            displayEntries();
        }

        function displayEntries() {
            const email = localStorage.getItem("currentUser");
            const users = JSON.parse(localStorage.getItem("users"));
            const entries = users[email].entries || [];
            const container = document.getElementById("displayContainer");
            container.innerHTML = ""; // Clear previous entries

            if (entries.length === 0) {
                // Hide the table if no entries
                tableWrapper.style.display = "none";
                return;
            }

            // Show the table if entries exist
            tableWrapper.style.display = "block";

            entries.forEach((entry, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                <td>${entry.name}</td>
                <td>${entry.designation}</td>
                <td>${entry.message}</td>
                <td class="text-end">
                    <button class="btn btn-sm btn-danger" onclick="deleteEntry(${index})">Delete</button>
                </td>`;
                container.appendChild(row);
            });
        }


        function deleteEntry(index) {
            const email = localStorage.getItem("currentUser");
            const users = JSON.parse(localStorage.getItem("users"));
            users[email].entries.splice(index, 1);
            localStorage.setItem("users", JSON.stringify(users));
            displayEntries();
        }

        function logout() {
            localStorage.removeItem("currentUser");
            togglePages("login");
        }

        window.onload = () => {
            const currentUser = localStorage.getItem("currentUser");
            if (currentUser) loadAccountPage(currentUser);
        };
    </script>
</body>

</html>